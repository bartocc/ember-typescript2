# Ember CLI with Typescript 2.x (EXPERIMENTAL)

This README outlines the details of collaborating on this Ember addon (bottom of README)

For more information on using ember-cli, visit
[https://ember-cli.com/](https://ember-cli.com/).


## WARNING: EXPERIMENTAL

While this addon should make it easy for anyone to get started with Typescript 2.x in Ember,
it doesn't provide 100% Type safety, and it still needs a lot of work (pull requests welcome!)

## Description

### This addon contains:

A rewritten type declaration for Ember 2.x, based on Typescript 2.x+ features such as:

- indexed signatures (for Ember.Objects)
- 'this parameters' (enables type checking stuff like this.store from setupController)
- lookup types (type checking in model.get() and model.set())

Please note that the type declarations are in an early stage and not complete.

# Installation

To install this addon and start using Typescript in your Ember project:

> ember install ember-typescript2

If you are using Visual Studio Code, enable the Typescript Language mode while editing one of your projects' .js files:
_View > Command Pallette .... > Language Mode > Typescript_

### How does it work?

- This addon runs Typescript during the Ember-CLI build process (using `broccoli-typescript-compiler`)
- All `.ts` and `.js` scripts in the *app/* folder are type checked and compiled (--allowJs and --checkJs flags)
- Type checking errors are displayed in the `ember serve` console

Note that for your convenience, also a tsconfig.json is installed in
your projects root. This allows for better IDE integration, and you can also 
run Typescript in standalone mode on your project:

Install Typescript globally:

> npm install -g typescript

Typecheck your code:

> cd your-ember-app/
> tsc

### Dependencies:

- typescript@next
- broccoli-typescript-compiler

### Configuration

To get Typechecking working for your models and services, have a look at
*app/types/application.d.ts* (automatically generated by ember-typescript2)

## Ember CLI build

This addon adds support for compilation of .ts files, and provides a (Typescript 2.x) interface declaration for ember and ember-data.

### Compilation is done with a Broccoli.js preprocessor

- Typescript is configured in broc-tsconfig.json with an outDir of `ts-frontend-compiled`
- From the Brocolli.js preprocessor, the `frontend/` tree is compiled to `frontend-compiled/` by *broccoli-typescript-compiler*, and then copied back to `frontend/` by *broccoli-funnel*

## Typescript 2.x types and interfaces for Ember

The main goal of this addon is to allow typechecking within your Ember
app, while you can keep writing your app in the conventional Ember
style:

````typescript
    import Ember from 'ember';

    export default Ember.Route.extend({
        setupController(controller, model) {
            var user = this.store.createRecord('user');
            user.set('non-existent-field', true);
                         ^--- type error because this property does
                              not exist on User models
        }
    });
````


The types and interfaces bundled with this addon provide an experimental
way to allow typechecking inside the standard Ember hooks like
`setupController`, `model`, etc.

The inferred types for models are kept simple, and are currently only
able to do basic typechecking on model.get() and model.set().

Currently `ember-typescript2` requires a you to import your models into `app/types/application.d.ts`, from there on, all types are generated automatically.

NOTE: It is also possible to define more comprehensive interfaces for your models if needed and import those instead


## Features

Type checking works for any non-Ember code as expected.

For Ember application code, the bundled Ember types and interface enable
the following checks:

- usage of deprecated Ember feature flags like MODEL_FACTORY_INJECTIONS
- Ember.String types (work in progress)
- Ember.Route hooks such as `model` and `setupController` are provided with the proper `this` context and access to `this.store`
- DS.Model
  - automatic inference of model types (see section "Using type inference on models")
  - `model.get()` and `model.set()` can only be called on defined properties
  - `model.get(key)` will retrieve the type of "`key`" as defined by `DS.attr()`
  - `model.set(key, ...)` will give a type error, if "key" is a computed property
  - `model.set(key, value)` will give a type error if `value` is of the wrong type
  - `model.get(key)` will retrieve the return type of a computed property (NOTE: this requires)
  - direct access of model attributes is guarded against (e.g. `model.key = "test"`)
  - readonly model properties (see section "Defining explicit model interfaces")
- `this parameter`: the right type of `this` within standard Ember hooks
  - allows typechecking stuff like `this.store.createRecord()` inside of a Route's `model()` hook




## Limitations


### `this parameter` context

For user defined methods it is currently not possible to set the `this
parameter` in combination with an indexed type.

This means that your custom methods won't have access to the proper
`this` context, and stuff like `this.store` doesn't work currently:

```typescript
export default Ember.Component.extend({
  store: Ember.inject.service('store'),

  doSomethingCustom(myParam) {
    let store = this.get('store');
    // type of both 'this' and 'store' is *any*
  }
}
```

Similarly, the proper `this` context is not afvailable inside computed property definitions yet:

```typescript
export default Ember.Object.extend({
  observedProp: "hello",

  computedProp: Ember.computed('observedProp', (myParam) {
    let value = this.get('observedProp');
    // type of 'value' is *any*:
  })
}
```

# Reporting issues

If you come accross any issues, we would really appricate it if you
report it in our [Github Issue tracker](issues).



# Contributing

Pull requests are welcome! This addon still needs a lot of work, and we
are very happy to get input from the Ember and Typescript
communities.



#### TODO:

* Allow .ts files to be generated with `ember generate` blueprints?
* Enable pretty-printing of type errors via `ember cli` (not supported by Typescript?)
* How to properly run broccoli-typescript-compiler before Babel? (see the current hacky method in index.js)
